<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>THE GRASSROOTS POST</title>
    

<script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900;500&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary-green': '#38A169', // A vibrant green for accents
                        'dark-green-header': '#1A6044', // Darker green for the top bar
                        'dark-text': '#1A202C',
                        'light-bg': '#F7FAFC',
                        'dark-footer': '#2D3748',
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style>
        .header-title {
            font-size: 3.5rem;
            line-height: 1.1;
        }
        @media (max-width: 640px) {
             .header-title {
                font-size: 2.5rem;
            }
        }
        /* Modal Backdrop */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.75);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 50;
            /* Hidden by default */
            display: none; 
        }
        /* Make modal active when shown */
        .modal-overlay.active {
            display: flex;
        }
        /* Style for the new report button section */
        .new-report-card {
            cursor: pointer;
            transition: all 0.2s;
        }
        .new-report-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(56, 161, 105, 0.1), 0 4px 6px -2px rgba(56, 161, 105, 0.05);
        }
    </style>
</head>
<body class="bg-light-bg font-sans text-dark-text">

    

<script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { 
            getFirestore, 
            collection, 
            addDoc, 
            query, 
            where, 
            orderBy, 
            limit, 
            onSnapshot, 
            setLogLevel 
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Global state for Firebase (MANDATORY for modal submission)
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let app, db, auth, userId = null;
        let isAuthReady = false;

        // Function to get the correct Firestore collection path
        const getPostsCollectionRef = (dbInstance, currentUserId) => {
            // Private user data path: /artifacts/{appId}/users/{userId}/posts
            return collection(dbInstance, `artifacts/${appId}/users/${currentUserId}/posts`);
        };

        // Helper to format date
        const formatDate = (timestamp) => {
            if (!timestamp) return 'Unknown Date';
            const date = timestamp.toDate ? timestamp.toDate() : new Date(timestamp);
            return date.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
        };

        // --- Firebase Initialization and Auth ---

        const initFirebase = () => {
            try {
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                // Set Firestore log level for debugging
                setLogLevel('Debug');
                
                // Sign in logic
                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        userId = user.uid;
                        isAuthReady = true;
                        document.getElementById('user-id-display').textContent = `User ID: ${userId}`;
                        // We will NOT call fetchAndRenderPosts() here, to keep static content.
                        // However, the modal submission will still work.
                    } else {
                        // Attempt to sign in using the custom token or anonymously
                        try {
                            if (initialAuthToken) {
                                await signInWithCustomToken(auth, initialAuthToken);
                            } else {
                                await signInAnonymously(auth);
                            }
                        } catch (error) {
                            console.error("Firebase Auth Error:", error);
                        }
                    }
                });

            } catch (error) {
                console.error("Firebase Initialization Failed:", error);
                document.getElementById('user-id-display').textContent = `Firebase Error: Check console.`;
            }
        };

        // --- Post Submission Logic ---
        
        const submitPost = async (event) => {
            event.preventDefault();
            
            if (!db || !userId) {
                // Display error in modal, not just console
                document.getElementById('modal-message').textContent = 'Database connection not ready. Ensure Firebase config is set up. Try again in a moment.';
                console.error("Database connection or User ID not ready for submission.");
                return;
            }

            const form = event.target;
            const post = {
                title: form.title.value,
                type: form.type.value,
                category: form.type.value === 'MATCH_REPORT' ? form.category.value : 'General Investigation',
                content: form.content.value,
                timestamp: new Date(),
                userId: userId
            };

            const postsRef = getPostsCollectionRef(db, userId);

            try {
                const submitButton = document.getElementById('submit-button');
                submitButton.disabled = true;
                submitButton.textContent = 'Saving...';
                await addDoc(postsRef, post);
                form.reset();
                hideModal();
                alert("Report successfully submitted! It will appear when dynamic content is enabled."); // User feedback
                console.log("Post successfully saved to Firebase.");
            } catch (error) {
                console.error("Error adding document: ", error);
                document.getElementById('modal-message').textContent = 'Error saving post. Check console for details and Firebase setup.';
            } finally {
                const submitButton = document.getElementById('submit-button');
                submitButton.disabled = false;
                submitButton.textContent = 'Submit Report';
            }
        };

        // --- Modal Control Logic ---
        const modal = document.getElementById('new-report-modal');

        const showModal = () => {
            modal.classList.add('active');
        }

        const hideModal = () => {
            document.getElementById('post-form').reset();
            document.getElementById('modal-message').textContent = '';
            modal.classList.remove('active');
        }

        // Attach event listeners after the DOM is loaded
        window.onload = () => {
            initFirebase();
            
            document.getElementById('new-report-card').addEventListener('click', showModal); 
            document.getElementById('close-modal-btn').addEventListener('click', hideModal);
            document.getElementById('post-form').addEventListener('submit', submitPost);
        };
    </script>


    
    <!-- New Top Bar -->
    <div class="bg-dark-green-header h-2"></div>

    <nav class="bg-white shadow-md">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                

<div class="flex-shrink-0">
                    <span class="text-xl font-extrabold text-dark-text tracking-wider">THE GRASSROOTS POST</span>
                </div>
                

<div class="hidden sm:ml-6 sm:flex sm:space-x-8">
                    <a href="#" class="text-dark-text hover:text-primary-green transition duration-150 ease-in-out px-3 py-2 text-sm font-semibold">MATCH REPORTS</a>
                    <a href="#" class="text-dark-text hover:text-primary-green transition duration-150 ease-in-out px-3 py-2 text-sm font-semibold">GRASSROOTS INVESTIGATIONS</a>
                    <a href="#" class="text-dark-text hover:text-primary-green transition duration-150 ease-in-out px-3 py-2 text-sm font-semibold">CONTACT</a>
                </div>
            </div>
        </div>
    </nav>

    

<header class="py-12 bg-white border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <h1 class="header-title font-extrabold text-dark-text">
                THE GRASSROOTS GAME
            </h1>
            <p class="text-xl text-gray-600 mt-2">
                Unrivaled match reporting and deep investigative features on youth football in Birmingham and the Midlands.
            </p>
             <p id="user-id-display" class="text-xs text-gray-400 mt-4">User ID: Loading...</p>
        </div>
    </header>

    

<main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12 lg:py-16">
        <div class="lg:grid lg:grid-cols-3 lg:gap-8">

            

<div class="lg:col-span-2 space-y-12">

                

<section class="bg-white p-6 rounded-xl shadow-lg border-t-4 border-primary-green">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        

<div class="md:col-span-2 bg-gray-200 rounded-lg h-64 flex items-center justify-center text-gray-500 font-medium">
                            VISUAL: Youth Team Action Placeholder
                        </div>
                        

<div class="md:col-span-1 flex flex-col justify-between">
                            <div>
                                <p class="text-sm font-bold text-primary-green uppercase tracking-wider mb-2">INVESTIGATION</p>
                                <h2 class="text-2xl font-extrabold text-dark-text mb-3 leading-snug">
                                    The Price of Potential: How Pitch Fees Are Squeezing Birmingham's Talent Pipeline
                                </h2>
                                <p class="text-gray-600 text-sm mb-4 line-clamp-4">
                                    An investigation into the rising costs of youth football, and the systemic barriers preventing low-income families from participating in the game.
                                </p>
                            </div>
                            <div class="text-xs text-gray-500">
                                Published Today by [Your Name]
                            </div>
                        </div>
                    </div>
                </section>
                
                

<section>
                    <h2 class="text-3xl font-extrabold text-dark-text mb-6">Latest Match Reports</h2>
                    
                    

<div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        

<div class="bg-white p-6 rounded-xl shadow-md border-t-2 border-gray-200 hover:shadow-lg transition duration-300">
                            <div class="bg-gray-200 rounded-lg h-40 mb-4 flex items-center justify-center text-gray-500">
                                Team Badge Placeholder
                            </div>
                            <p class="text-xs font-bold text-red-600 uppercase mb-1">REPORT: MIDLANDS LEAGUE</p>
                            <h3 class="text-xl font-semibold text-dark-text mb-2 leading-snug">
                                South Birmingham United Grind Out a Desperate 1-0 Win Over Lye Town
                            </h3>
                            <a href="#" class="text-sm text-primary-green font-medium hover:underline">Read the Full Report &rarr;</a>
                        </div>
                        

<div class="bg-white p-6 rounded-xl shadow-md border-t-2 border-gray-200 hover:shadow-lg transition duration-300">
                            <div class="bg-gray-200 rounded-lg h-40 mb-4 flex items-center justify-center text-gray-500">
                                Team Badge Placeholder
                            </div>
                            <p class="text-xs font-bold text-red-600 uppercase mb-1">REPORT: RESERVES</p>
                            <h3 class="text-xl font-semibold text-dark-text mb-2 leading-snug">
                                Westside Reserves Show Flashes of Brilliance in 3-3 Thriller
                            </h3>
                            <a href="#" class="text-sm text-primary-green font-medium hover:underline">Read the Full Report &rarr;</a>
                        </div>
                        

<div class="bg-white p-6 rounded-xl shadow-md border-t-2 border-gray-200 hover:shadow-lg transition duration-300">
                            <div class="bg-gray-200 rounded-lg h-40 mb-4 flex items-center justify-center text-gray-500">
                                Team Badge Placeholder
                            </div>
                            <p class="text-xs font-bold text-red-600 uppercase mb-1">REPORT: ACADEMY FIXTURE</p>
                            <h3 class="text-xl font-semibold text-dark-text mb-2 leading-snug">
                                Lichfield City's Midfield Overrun: Defensive Concerns After 4-1 Loss
                            </h3>
                            <a href="#" class="text-sm text-primary-green font-medium hover:underline">Read the Full Report &rarr;</a>
                        </div>
                        

<div class="bg-white p-6 rounded-xl shadow-md border-t-2 border-gray-200 hover:shadow-lg transition duration-300">
                            <div class="bg-gray-200 rounded-lg h-40 mb-4 flex items-center justify-center text-gray-500">
                                Team Badge Placeholder
                            </div>
                            <p class="text-xs font-bold text-red-600 uppercase mb-1">REPORT: NON-LEAGUE CUP</p>
                            <h3 class="text-xl font-semibold text-dark-text mb-2 leading-snug">
                                Five Talking Points from Boldmere St Michaels' Stoppage Time Drama
                            </h3>
                            <a href="#" class="text-sm text-primary-green font-medium hover:underline">Read the Full Report &rarr;</a>
                        </div>
                    </div>
                    
                    <div class="text-center mt-8">
                        <button class="bg-white text-dark-text font-semibold px-6 py-3 rounded-lg shadow-md border border-gray-300 hover:bg-gray-100 transition duration-150">
                            Load More Match Reports
                        </button>
                    </div>

                </section>
                
                

<section class="mt-8">
                    <div id="new-report-card" class="new-report-card bg-white p-6 rounded-xl shadow-lg border-2 border-dashed border-primary-green text-center text-primary-green">
                        <div class="flex items-center justify-center space-x-3">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" />
                            </svg>
                            <h2 class="text-xl font-bold">Create New Report (Match or Investigation)</h2>
                        </div>
                        <p class="text-sm mt-1 text-gray-600">Click here to write and publish your next article to the front page.</p>
                    </div>
                </section>

            </div>

            

<div class="lg:col-span-1 mt-12 lg:mt-0 space-y-8">
                
                

<div class="bg-primary-green p-6 rounded-xl shadow-xl text-white">
                    <h3 class="text-xl font-bold mb-3">Grassroots Investigations</h3>
                    <p class="text-sm opacity-90 mb-4">
                        Deep dives into the urgent financial, ethical, and structural issues surrounding grassroots football development in the Midlands.
                    </p>
                    <button class="bg-white text-primary-green font-bold px-4 py-2 rounded-lg shadow-md hover:bg-gray-100 transition duration-150">
                        Read All Investigative Reports
                    </button>
                </div>

                

<div class="bg-white p-6 rounded-xl shadow-xl border-t-4 border-gray-300">
                    <h3 class="text-xl font-bold text-dark-text mb-3">About The Reporter</h3>
                    <p class="text-gray-600 text-sm mb-4">
                        [Your Name] covers the non-league scene, providing match-day insight and the crucial issues affecting the future of youth development.
                    </p>
                    <a href="#" class="text-sm text-primary-green font-medium hover:underline flex items-center">
                        Get in touch for Pitches & Tips &rarr;
                    </a>
                </div>

            </div>
        </div>
    </main>

    

<footer class="bg-dark-footer text-white py-12 mt-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <h4 class="text-2xl font-bold mb-2">THE GRASSROOTS POST</h4>
            <p class="text-sm text-gray-400 mb-6">
                © 2024 Independent Football Journalism for the Midlands.
            </p>
            <div class="flex justify-center space-x-6 text-sm font-medium">
                <a href="#" class="text-gray-300 hover:text-primary-green transition duration-150">Our Mission</a>
                <a href="#" class="text-gray-300 hover:text-primary-green transition duration-150">Pitches</a>
                <a href="#" class="text-gray-300 hover:text-primary-green transition duration-150">Archive</a>
            </div>
        </div>
    </footer>

    

<div id="new-report-modal" class="modal-overlay">
        <div class="bg-white p-8 rounded-xl shadow-2xl max-w-2xl w-full mx-4 relative overflow-y-auto max-h-[90vh]">
            
            <div class="flex justify-between items-center border-b pb-3 mb-4">
                <h2 class="text-2xl font-bold text-dark-text">Submit New Report</h2>
                <button id="close-modal-btn" class="text-gray-500 hover:text-gray-700 transition">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>

            <form id="post-form" class="space-y-4">
                
                <div>
                    <label for="title" class="block text-sm font-medium text-gray-700 mb-1">Title</label>
                    <input type="text" id="title" name="title" required class="w-full border-gray-300 rounded-lg shadow-sm focus:border-primary-green focus:ring-primary-green p-3">
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label for="type" class="block text-sm font-medium text-gray-700 mb-1">Type of Content</label>
                        <select id="type" name="type" required class="w-full border-gray-300 rounded-lg shadow-sm focus:border-primary-green focus:ring-primary-green p-3">
                            <option value="MATCH_REPORT">Match Report</option>
                            <option value="INVESTIGATION">Investigation</option>
                        </select>
                    </div>
                    <div>
                        <label for="category" class="block text-sm font-medium text-gray-700 mb-1">Category / League</label>
                        <select id="category" name="category" required class="w-full border-gray-300 rounded-lg shadow-sm focus:border-primary-green focus:ring-primary-green p-3">
                            <option value="MIDLANDS LEAGUE">Midlands League</option>
                            <option value="RESERVES">Reserves</option>
                            <option value="ACADEMY FIXTURE">Academy Fixture</option>
                            <option value="NON-LEAGUE CUP">Non-League Cup</option>
                        </select>
                    </div>
                </div>

                <div>
                    <label for="content" class="block text-sm font-medium text-gray-700 mb-1">Report Content (Full Text)</label>
                    <textarea id="content" name="content" rows="10" required class="w-full border-gray-300 rounded-lg shadow-sm focus:border-primary-green focus:ring-primary-green p-3"></textarea>
                </div>
                
                <p id="modal-message" class="text-sm text-red-500"></p>

                <button type="submit" id="submit-button" class="w-full bg-primary-green text-white font-bold py-3 rounded-lg hover:bg-green-700 transition duration-150 shadow-md">
                    Submit Report
                </button>
            </form>
        </div>
    </div>

</body>
</html>

